<Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0">
    
    <Import Project="Snap.Deps.targets" />

    <PropertyGroup>
        <TargetFrameworks Condition="$(OsPlatform) == 'Windows'">netcoreapp2.1;netstandard2.0;net461</TargetFrameworks>
        <TargetFrameworks Condition="$(OsPlatform) != 'Windows'">netcoreapp2.1;netstandard2.0</TargetFrameworks>
        <RootNamespace>Snap</RootNamespace>
        <AssemblyName>Snap</AssemblyName>
        <PackageId>Snap</PackageId>
        <Description>A cross platform application updater for .NET applications targeting either Windows or Unix.</Description>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
        <IAmSnapCore>true</IAmSnapCore>
        <DefineConstants>$(DefineConstants);LIBLOG_PUBLIC;</DefineConstants>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="ILRepack.MSBuild.Task" Version="2.0.3">
            <PrivateAssets>all</PrivateAssets>
        </PackageReference>
        <PackageReference Include="LibLog" Version="5.0.5">
          <PrivateAssets>all</PrivateAssets>
          <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
        </PackageReference>
    </ItemGroup>
    
    <ItemGroup Condition="$(OsPlatform) == 'Windows'">
        <EmbeddedResource Include="../../build/Windows/win7-x64/$(Configuration)/Snap.CoreRun/$(Configuration)/corerun.exe" Link="Resources\corerun\corerun.exe" />
        <EmbeddedResource Include="../../build/Unix/x86_64-linux-gcc/$(Configuration)/Snap.CoreRun/corerun" Link="Resources/corerun/corerun" />
    </ItemGroup>
    
    <ItemGroup Condition="$(OsPlatform) == 'Unix'">
        <EmbeddedResource Include="../../build/Unix/x86_64-w64-mingw32-gcc/$(Configuration)/Snap.CoreRun/corerun.exe" Link="Resources/corerun/corerun.exe" />
        <EmbeddedResource Include="../../build/Unix/x86_64-linux-gcc/$(Configuration)/Snap.CoreRun/corerun" Link="Resources/corerun/corerun" />
    </ItemGroup>
    
    <Target Name="SnapCoreILRepackPackageRelease" AfterTargets="Build" Condition="'$(SnapNupkg)' == 'true' AND '$(TargetFramework)' != ''">
        <Error Text="Do not generate a nupkg using Linux. The binary generated by mingw-64 is 5 times greater then the binary generated by MSVS" Condition="$(OsPlatform) != 'Windows'" />
        <ILRepack OutputType="$(OutputType)" MainAssembly="$(AssemblyName).dll" OutputAssembly="$(AssemblyName).dll" InputAssemblies="@(SnapCoreILRepackInputAssemblies)" InternalizeExcludeAssemblies="@(SnapCoreILRepackInternalizeExcludeAssemblies)" WorkingDirectory="$(SnapCoreILRepackWorkingDirectory)" />
    </Target>
    
</Project>
