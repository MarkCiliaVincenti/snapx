<Project Sdk="Microsoft.NET.Sdk" ToolsVersion="15.0">

    <Import Project="Snap.Deps.targets" />

    <PropertyGroup>
        <TargetFrameworks>netcoreapp2.1;netstandard2.0;net461</TargetFrameworks>
        <RootNamespace>Snap</RootNamespace>
        <AssemblyName>Snap</AssemblyName>
        <PackageId>Snap.Core</PackageId>
        <Description>A portable application updater for .NET core applications running on either Windows or Unix.</Description>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
        <IAmSnapCore>true</IAmSnapCore>
    </PropertyGroup>

    <ItemGroup>
        <Compile Remove="bin\**" />
        <Compile Remove="nupkgs\**" />
        <Compile Remove="obj\**" />
        <EmbeddedResource Remove="bin\**" />
        <EmbeddedResource Remove="nupkgs\**" />
        <EmbeddedResource Remove="obj\**" />
        <None Remove="bin\**" />
        <None Remove="nupkgs\**" />
        <None Remove="obj\**" />
    </ItemGroup>

    <ItemGroup Condition="'$(IsNetStandard)' == 'true'">
        <PackageReference Include="System.Runtime.InteropServices.RuntimeInformation" Version="4.3.0">
            <PrivateAssets>all</PrivateAssets>
        </PackageReference>
    </ItemGroup>

    <ItemGroup Condition="'$(IsNetFullFramework)' == 'true'">
        <PackageReference Include="System.Runtime.InteropServices.RuntimeInformation" Version="4.3.0">
            <PrivateAssets>all</PrivateAssets>
        </PackageReference>
    </ItemGroup>

    <ItemGroup>
        <PackageReference Include="ILRepack.MSBuild.Task" Version="2.0.3">
            <PrivateAssets>all</PrivateAssets>
        </PackageReference>
    </ItemGroup>

    <Target Name="ILRepack" AfterTargets="Build" Condition="'$(SnapCorePackageRelease)' == 'true'">

        <PropertyGroup>
            <WorkingDirectory>$(MSBuildThisFileDirectory)bin\$(Configuration)\$(TargetFramework)</WorkingDirectory>
        </PropertyGroup>

        <ItemGroup Condition="'$(IsNetCoreApp)' == 'true'">
            <InputAssemblies Include="Microsoft.Win32.SystemEvents.dll" />
        </ItemGroup>

        <ItemGroup Condition="'$(IsNetStandard)' == 'true'">
            <InputAssemblies Include="System.Runtime.InteropServices.RuntimeInformation.dll" />
        </ItemGroup>

        <ItemGroup Condition="'$(IsNetFullFramework)' == 'true'">
            <InputAssemblies Include="System.Runtime.InteropServices.RuntimeInformation.dll" />
            <InputAssemblies Include="System.ValueTuple.dll" />
        </ItemGroup>

        <ItemGroup>
            <InputAssemblies Include="Mono.Cecil.dll" />
            <InputAssemblies Include="Mono.Cecil.Mdb.dll" />
            <InputAssemblies Include="Mono.Cecil.Pdb.dll" />
            <InputAssemblies Include="Mono.Cecil.Rocks.dll" />
            <InputAssemblies Include="Newtonsoft.Json.dll" />
            <InputAssemblies Include="NuGet.Common.dll" />
            <InputAssemblies Include="NuGet.Configuration.dll" />
            <InputAssemblies Include="NuGet.Frameworks.dll" />
            <InputAssemblies Include="NuGet.Packaging.Core.dll" />
            <InputAssemblies Include="NuGet.Packaging.dll" />
            <InputAssemblies Include="NuGet.Versioning.dll" />
            <InputAssemblies Include="Splat.dll" />
            <InputAssemblies Include="System.Drawing.Common.dll" />
            <InputAssemblies Include="YamlDotNet.NetCore.dll" />
            <InputAssemblies Include="NuGet.Versioning.dll" />
            <InputAssemblies Include="FasterFlect.NETStandard.dll" />
            <InputAssemblies Include="Jetbrains.Annotations" />
            <InputAssemblies Include="ILRepack.NETStandard.dll" />
            <InputAssemblies Include="Snap.Core.dll" />
        </ItemGroup>

        <ItemGroup>
            <InternalizeExcludeAssemblies Include="NuGet.Versioning.SemanticVersion" />
        </ItemGroup>

        <ILRepack OutputType="$(OutputType)" MainAssembly="$(AssemblyName).dll" OutputAssembly="$(AssemblyName).dll" InputAssemblies="@(InputAssemblies)" InternalizeExcludeAssemblies="@(InternalizeExcludeAssemblies)" WorkingDirectory="$(WorkingDirectory)" />

    </Target>

</Project>
